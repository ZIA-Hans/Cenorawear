{%- liquid
  assign custom_height_ratio = section.settings.custom_image_ratio | divided_by: 100.0
  assign image_width = 430
  assign image_height = image_width | times: custom_height_ratio | round
  assign limit = section.settings.number_of_items
  case limit
    when 0
      assign width_class = 'width-20'
    when 2
      assign width_class = 'width-50'
    when 3
      assign width_class = 'width-33'
    when 4
      assign width_class = 'width-25'
    when 5
      assign width_class = 'width-20'
    when 6
      assign width_class = 'width-16'
    when 7
      assign width_class = 'width-14'
    else
      assign width_class = 'width-12'
  endcase
  assign img_width_limit = limit
  assign img_width = 100 | divided_by: img_width_limit
-%}
{%- paginate collections by section.settings.pagination_qty -%}
  <header class="cols text-{{ section.settings.text_alignment }}">
    <{{ section.settings.title_size }}>{{ 'collection.all_collections' | t }}</{{ section.settings.title_size }}>
  </header>

  <ul
    class="l4cl catalog {{ width_class }} mobile-scroll w50-mobile{% if section.settings.show_in_circle and section.settings.custom_image_ratio == 100 %} rounded{% endif %}"
    style="--ratio:{{ section.settings.custom_image_ratio | divided_by: 100.0 }}"
  >
    {%- for collection in collections -%}
      {%- liquid
        capture current
          cycle 1, 2, 3, 4, 5, 6
        endcapture
      -%}
      <li
        {% if settings.enable_animations %}
          data-sal="fade" data-sal-duration="500" data-sal-delay="{{ forloop.index0 | times: 50 }}"
        {% endif %}
      >
        <figure
          class="palette-{{ section.settings.color_palette }} no-before module-color-palette{% if section.settings.fill_images %} img-cover{% endif %}"
          style="--ratio:{{ section.settings.custom_image_ratio | divided_by: 100.0 }}"
        >
          {% unless section.settings.show_below %}<a href="{{ collection.url }}">{% endunless %}
          <span
            class="img-overlay"
            style="opacity:{{ section.settings.image_overlay_opacity | divided_by: 100.0 }}"
          ></span>
          <picture class="{% if settings.multiply_collection_images == 'multiply' %}img-multiply{% elsif settings.multiply_collection_images == 'multiply-bg' %}img-multiply-bg{% endif %}">
            {% if collection.featured_image %}
              <img
                src="{{ collection.featured_image | image_url: width: image_width, height: image_height }}"
                srcset="{% render 'image-srcset', image: collection.featured_image %}"
                sizes="
                  {% if settings.width < 2000 %}
                    (min-width: 1300px) {% if img_width == 100 %}calc({{ settings.width }}px * 0.2){% else %}calc({{ settings.width }}px * 0.{{ img_width }}){% endif %},
                  {% endif %}
                  (min-width: 760px) {% if img_width == 100 %}calc(100vw * 0.2){% else %}calc(100vw * 0.{{ img_width }}){% endif %},
                  141px
                "
                width="{{ image_width }}"
                height="{{ image_height }}"
                alt="{% if collection.featured_image.alt == blank or collection.featured_image.alt == collection.title %}Collection image for: {% endif %}{{ collection.featured_image.alt | default: collection.title | escape }}"
                loading="lazy"
              >
            {% else %}
              {{ 'collection-' | append: current | placeholder_svg_tag: 'placeholder-svg' }}
            {% endif %}
          </picture>
          {% if section.settings.show_below %}
            <a href="{{ collection.url }}" class="link-overlay"></a>
          {% else %}
            <{{ section.settings.collection_title_size }} class="figcaption {% if section.settings.collection_title_position == 'center' %} text-center{% endif %}">
              {{- collection.title }}
              {% if section.settings.show_arrow -%}
                <i aria-hidden="true" class="icon-arrow-right invisible"></i>
              {%- endif -%}
            </{{ section.settings.collection_title_size }}>
            </a>
          {% endif %}
        </figure>
        {% if section.settings.show_below %}
          <div>
            <{{ section.settings.collection_title_size }} class="{% if section.settings.collection_title_position == 'center' %}text-center{% endif %}{% if section.settings.enable_custom_text_styling %} text-palette-{{ section.settings.title_color_palette }}{% endif %}"
              ><a href="{{ collection.url }}">
                {{- collection.title }}
                {% if section.settings.show_arrow -%}
                  <i aria-hidden="true" class="icon-arrow-right invisible"></i>
                {%- endif -%}</a
            ></{{ section.settings.collection_title_size }}>
          </div>
        {% endif %}
      </li>
    {%- endfor -%}
  </ul>
  {% render 'pagination', paginate: paginate, mobile_center: true %}
{%- endpaginate -%}

{% schema %}
{
  "name": "t:main.list_collection.name",
  "class": "margin-double",
  "tag": "article",
  "settings": [
    {
      "type": "select",
      "id": "text_alignment",
      "label": "t:main.list_collection.settings.text_alignment.label",
      "options": [
        {
          "value": "start",
          "label": "t:main.list_collection.settings.text_alignment.options__1.label"
        },
        {
          "value": "center",
          "label": "t:main.list_collection.settings.text_alignment.options__2.label"
        }
      ],
      "default": "start"
    },
    {
      "id": "title_size",
      "type": "select",
      "label": "t:main.list_collection.settings.title_size.label",
      "options": [
        {
          "value": "h5",
          "label": "t:global.typography.title_size.h5.label"
        },
        {
          "value": "h4",
          "label": "t:global.typography.title_size.h4.label"
        },
        {
          "value": "h3",
          "label": "t:global.typography.title_size.h3.label"
        },
        {
          "value": "h2",
          "label": "t:global.typography.title_size.h2.label"
        },
        {
          "value": "h1",
          "label": "t:global.typography.title_size.h1.label"
        }
      ],
      "default": "h2"
    },
    {
      "type": "color_scheme",
      "id": "color_palette",
      "label": "t:global.color_palette.label",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "image_overlay_opacity",
      "label": "t:main.list_collection.settings.image_overlay_opacity.label",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "default": 0
    },
    {
      "id": "custom_image_ratio",
      "type": "range",
      "label": "t:main.list_collection.settings.custom_image_ratio.label",
      "info": "t:main.list_collection.settings.custom_image_ratio.info",
      "min": 50,
      "max": 175,
      "step": 5,
      "unit": "%",
      "default": 100
    },
    {
      "id": "show_in_circle",
      "type": "checkbox",
      "label": "t:main.list_collection.settings.show_in_circle.label",
      "info": "t:main.list_collection.settings.show_in_circle.info",
      "visible_if": "{{ section.settings.custom_image_ratio == 100 }}"
    },
    {
      "id": "fill_images",
      "type": "checkbox",
      "label": "t:main.list_collection.settings.fill_images.label",
      "default": true
    },
    {
      "type": "select",
      "id": "collection_title_position",
      "label": "t:main.list_collection.settings.collection_title_position.label",
      "options": [
        {
          "value": "start",
          "label": "t:main.list_collection.settings.collection_title_position.options__1.label"
        },
        {
          "value": "center",
          "label": "t:main.list_collection.settings.collection_title_position.options__2.label"
        }
      ],
      "default": "start"
    },
    {
      "type": "select",
      "id": "collection_title_size",
      "label": "t:main.list_collection.settings.collection_title_size.label",
      "options": [
        {
          "value": "h5",
          "label": "t:global.typography.title_size.h5.label"
        },
        {
          "value": "h4",
          "label": "t:global.typography.title_size.h4.label"
        },
        {
          "value": "h3",
          "label": "t:global.typography.title_size.h3.label"
        },
        {
          "value": "h2",
          "label": "t:global.typography.title_size.h2.label"
        },
        {
          "value": "h1",
          "label": "t:global.typography.title_size.h1.label"
        }
      ],
      "default": "h5"
    },
    {
      "type": "checkbox",
      "id": "show_below",
      "label": "t:main.list_collection.settings.show_below.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_arrow",
      "label": "t:main.list_collection.settings.show_arrow.label"
    },
    {
      "type": "range",
      "id": "pagination_qty",
      "label": "t:main.list_collection.settings.pagination_qty.label",
      "min": 12,
      "max": 48,
      "step": 12,
      "default": 48
    },
    {
      "type": "range",
      "id": "number_of_items",
      "label": "t:main.list_collection.settings.number_of_items.label",
      "min": 2,
      "max": 8,
      "step": 1,
      "default": 5
    }
  ]
}
{% endschema %}
